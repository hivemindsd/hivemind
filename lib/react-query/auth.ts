import { useQuery } from '@tanstack/react-query'
import { createClient } from '@/lib/supabase/client'
import type { User } from '@supabase/supabase-js'

// this will fetch from the supabase auth user endpoint
export function useCurrentClientUser() {
	return useQuery({
		queryKey: ['currentUser'],
		queryFn: async (): Promise<User | null> => {
			const supabase = createClient()
			const {
				data: { user },
				error
			} = await supabase.auth.getUser()

			if (error) throw error
			return user
		},
		staleTime: 5 * 60 * 1000,
		retry: false
	})
}

// this will fetch from the client user session token claims
export function useCurrentClientUserClaims() {
	return useQuery({
		queryKey: ['currentUserClaims'],
		queryFn: async (): Promise<Record<string, unknown> | null> => {
			const supabase = createClient()
			const { data, error } = await supabase.auth.getClaims()

			if (error) throw error
			return data?.claims ?? null
		},
		staleTime: 5 * 60 * 1000,
		retry: false
	})
}
